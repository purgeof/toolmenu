<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>å› æ•¸èˆ‡å€æ•¸æ¶ˆæ¶ˆæ¨‚ - æŒ‘æˆ°ç‰ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f4f8; /* æ·ºç°è‰²èƒŒæ™¯ */
            color: #4a5568;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 2em;
            margin-bottom: 1.5em; /* å¢åŠ èˆ‡ä¸‹æ–¹å…§å®¹çš„é–“è· */
            justify-content: center;
            color: #553c9a; /* æ·±ç´«è‰² */
        }
        button {
            cursor: pointer;
        }
        .number-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
            justify-content: center;
            margin-top: 15px;
            /* ä¿®æ­£å¾Œçš„æ•¸å­—ç¶²æ ¼æ¨£å¼ */
            border: 1px solid transparent; /* éš±è—é‚Šæ¡† */
            border-radius: 12px; /* åœ“è§’æ•ˆæœ */
            padding: 24px; /* å¢åŠ å…§é‚Šè· */
            background-color: #d1e2d1; /* æ·ºç¶ è‰²èƒŒæ™¯ */
            max-width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .number-grid button {
            /* ä¿®æ­£å¾Œçš„æŒ‰éˆ•æ¨£å¼ */
            border: 1px solid #c9c9c9;
            background: #fff;
            font-size: 20px;
            font-weight: 500;
            user-select: none;
            height: 48px;
            width: 48px;
            border-radius: 8px;
            transition: background-color 0.2s, color 0.2s;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* å¢åŠ è¼•å¾®é™°å½± */
        }
        .number-grid button:hover:not(:disabled) {
            background-color: #ebf4ff;
            border-color: #0c38ea;
            color: #2c5282;
        }
        .selected {
            cursor: not-allowed;
            font-weight: 900;
        }
        /* ç©å®¶1å’Œç©å®¶2çš„å°ˆå±¬é¡è‰² */
        .selected.player1 {
            background-color: #fceb9f; /* æŸ”å’Œçš„é»ƒè‰² */
            color: #a05a16; /* æ·±è‰²çš„å­—é«”ï¼Œè®“æ–‡å­—æ›´æ¸…æ™° */
        }
        .selected.player2 {
            background-color: #d8f5f8; /* æŸ”å’Œçš„æ·¡è—è‰² */
            color: #1a5b64; /* æ·±è‰²çš„å­—é«”ï¼Œè®“æ–‡å­—æ›´æ¸…æ™° */
        }
        .selected::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 15%;
            width: 70%;
            height: 2px;
            background-color: #5305ee;
            transform: translateY(-50%);
            pointer-events: none;
        }
        .last-selected {
            outline: 3px solid #d69e2e;
            outline-offset: 1px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex-grow: 1;
        }
        input{
            width: 100%;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 6px;
            outline-offset: 2px;
        }
        input:focus {
            border-color: #6b46c1;
            caret-color: #6b46c1;
            box-shadow: 0 0 4px #6b46c1aa;
        }
        .btn-primary {
            background-color: #7f55b9; /* èª¿æ•´æŒ‰éˆ•é¡è‰² */
            color: #fff;
            border: none;
            padding: 12px 24px; /* å¢åŠ æŒ‰éˆ•å¤§å° */
            font-weight: 700;
            font-size: 1.1em;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            user-select: none;
            transition: background-color 0.2s;
            margin-top: 20px; /* å¢åŠ èˆ‡ä¸Šæ–¹å…§å®¹çš„é–“è· */
        }
        .btn-primary:hover {
            background-color: #6b46c1;
        }
        .alert {
    border-radius: 8px;
    padding: 10px 15px;
    margin-bottom: 15px;
    font-weight: 800; /* åŠ ç²—å­—é«”ï¼Œå¯ä»¥èª¿æ•´ç‚º 700, 800 æˆ– 900 */
    font-size: 28px; /* æ”¾å¤§å­—é«”ï¼Œå¯ä»¥èª¿æ•´ç‚º 1.2em, 1.4em ç­‰ */
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            /* æ–°å¢æ¨£å¼ä¾†å±…ä¸­é¡¯ç¤º */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 400px;
            text-align: center;
            z-index: 100; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
        }
        .alert.error {
            background-color: #fff5f5;
            color: #c53030;
            border: 1px solid #f56565;
            font-size: 3em; /* é€™è£¡å–®ç¨æ”¾å¤§éŒ¯èª¤è¨Šæ¯çš„å­—é«” */
            font-weight: 800; /* é€™è£¡å–®ç¨åŠ ç²—éŒ¯èª¤è¨Šæ¯çš„å­—é«” */
            border: 1px solid #f56565;
            
        }
        .alert.success {
            background-color: #f0fff4;
            color: #38a169;
            border: 1px solid #48bb78;
        }
        .panel {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 14px;
            line-height: 1.4;
            color: #6b46c1;
        }
        .rules-panel {
            background-color: #f7f3ff; /* éŠæˆ²è¦å‰‡å€å¡ŠèƒŒæ™¯è‰² */
            border-radius: 10px;
            padding: 0px; /* èª¿æ•´å…§é‚Šè· */
            margin-bottom: 0px; /* å¢åŠ é–“è· */
            text-align: left;
            color: #553c9a;
            font-size: 20px; /* èª¿æ•´å­—é«”å¤§å° */
             /*width: 100%; ç¢ºä¿è¦å‰‡å€å¡Šä½”æ»¿å¯¬åº¦ */
        }
        .rules-panel h2 {
            text-align: center;
            font-size: 1.5em; /* èª¿æ•´æ¨™é¡Œå­—é«”å¤§å° */
            font-weight: bold;
            color: #553c9a;
            margin-bottom: 1em;
        }
        .rules-panel ol, .rules-panel ul {
            padding-left: 20px;
            margin-left: 0;
        }
        .rules-panel li {
            margin-bottom: 8px;
        }
        .hint-box {
            background-color: #fefcbf;
            border: 5px solid #faf089;
            border-radius: 8px;
            padding: 6px;
            margin-top: 10px;
            color: #975a16;
            font-size: 20px;
        }
        .hint-box h3 {
            margin-top: 0;
            margin-bottom: 0px;
            font-weight: 800;
        }
        .restart-btn {
            /* æ¨¡ä»¿ã€Œé–‹å§‹æŒ‘æˆ°ã€æŒ‰éˆ•æ¨£å¼ */
            display: flex; /* ä½¿ç”¨ flexbox ä½ˆå±€ï¼Œè®“åœ–ç¤ºå’Œæ–‡å­—å¯ä»¥å°é½Š */
            align-items: center; /* å‚ç›´å±…ä¸­å°é½Š */
            justify-content: center; /* æ°´å¹³å±…ä¸­å°é½Š */
            padding: 10px 30px; /* å¢åŠ å…§é‚Šè·ï¼Œè®“æŒ‰éˆ•æ›´å¯¬å¤§ */
            border: none;
            border-radius: 50px; /* è¨­å®šå¤§åœ“è§’ï¼Œæ¥è¿‘è† å›Šç‹€ */
            background-color: #6a4c93; /* è¨­å®šç‚ºç´«è‰² */
            color: #ffffff; /* æ–‡å­—é¡è‰²ç‚ºç™½è‰² */
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* å¢åŠ è¼•å¾®é™°å½± */
            transition: all 0.3s ease; /* å¢åŠ éæ¸¡æ•ˆæœ */
            margin-top: 0px;
        }
        .restart-btn:hover {
            background-color: #5b3d84; /* æ»‘é¼ æ‡¸åœæ™‚é¡è‰²è®Šæ·± */
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .restart-btn:active {
            background-color: #4c306d; /* é»æ“Šæ™‚é¡è‰²æ›´æ·±ï¼Œæ¨¡æ“¬æŒ‰å£“æ„Ÿ */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .restart-btn .icon {
            font-size: 24px;
            margin-right: 10px; /* åœ–ç¤ºèˆ‡æ–‡å­—ä¹‹é–“çš„é–“è· */
        }
        .restart-btn .text {
            /* é€™è£¡æ²’æœ‰é¡å¤–æ¨£å¼ï¼Œä½†å¯ä»¥æ ¹æ“šéœ€è¦æ·»åŠ  */
        }
        .flex-col {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center; /* ç¢ºä¿æ‰€æœ‰å­å…ƒç´ å‚ç›´å±…ä¸­ */
        }
        .flex-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center; /* æ°´å¹³å±…ä¸­ */
        }
        .flex-grow {
            flex-grow: 1;
        }
        .explanation-row {
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        .explanation-row span:first-child {
            font-weight: bold;
            min-width: 24px;
        }
        .player-inputs {
            display: flex;
            gap: 70px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 0px 0; /* å¢åŠ ä¸Šä¸‹é–“è· */
            font-size: 1.3em;
        }
        .player-input-group {
            flex-grow: 1;
            max-width: 100px;
        }
        /* ä¿®æ­£å¾Œçš„ info å€å¡Šæ’ç‰ˆ */
        #info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px; /* å¢åŠ å…§é‚Šè· */
            background: #f7fafc;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: 600;
        }
        .turn-info {
            font-size: 1.5em;
            font-weight: bold;
            color: #4a5568;
        }
        .last-number-info {
            font-size: 1.5em;
            font-weight: bold;
            color: #f10303;
        }
        .win-animation {
            animation: celebrate 1s infinite alternate; /* 1ç§’çš„ç„¡é™å¾ªç’°å‹•ç•«ï¼Œäº¤æ›¿åŸ·è¡Œ */
        }
        @keyframes celebrate {
            0% {
                transform: scale(1);
                color: #38a169; /* ç²å‹æ–‡å­—é¡è‰² */
            }
            100% {
                transform: scale(1.2);
                color: #48bb78; /* ç²å‹æ–‡å­—æ”¾å¤§å¾Œçš„é¡è‰² */
            }
        }
    </style>
</head>
<body>
    <div id="setup" class="flex-col" style="align-items: center;">
        <div class="rules-panel">
            <h2>ğŸ§  å› æ•¸èˆ‡å€æ•¸æ¶ˆæ¶ˆæ¨‚ - æŒ‘æˆ°ç‰ˆ</h2>
            <h2>éŠæˆ²è¦å‰‡</h2>
            <ol>
                <li>å…©äººä¸€çµ„ï¼Œåˆ†æˆã€Œå…ˆæ”»ã€å¾Œæ”»ã€</li>
                <li>å…ˆæ”»_å¾ã€Œ1ï½20ã€ä¸­ï¼Œé¸ä¸€å€‹æ•¸ï¼Œ<BR>å¾Œæ”»_é¸ã€Œè©²æ•¸å­—ã€çš„å› æ•¸ or å€æ•¸</li>
                <li>é¸éçš„æ•¸ï¼Œè¢«åŠƒæ‰ï¼Œä¸èƒ½å†é¸</li>
                <li>è®“å°æ–¹ã€Œç„¡æ³•å†é¸ã€æ™‚ï¼Œä½ ï½å°±ç²å‹ï¼</li>
            </ol>
            <div class="hint-box">
                <h3>æŒ‘æˆ°æ¨¡å¼ç‰¹è‰²</h3>
                <ul>
                    <li style="color: #c05621;">æ²’æœ‰æ•¸å­—æç¤ºï¼Œå®Œå…¨é è‡ªå·±åˆ¤æ–·ï¼</li>
                    <li style="color: #c05621;">è€ƒé©—ä½ å°å› æ•¸èˆ‡å€æ•¸çš„ç†è§£</li>
                    <li style="color: #c05621;">åŸ¹é¤Šç¨ç«‹æ€è€ƒå’Œè¨ˆç®—èƒ½åŠ›</li>
                </ul>
            </div>
        </div>
        <div class="player-inputs">
            <div class="input-group player-input-group">
                <label for="player1" style="color: #553c9a;">å…ˆæ”»ç©å®¶</label>
                <input type="text" id="player1" placeholder="è¼¸å…¥å…ˆæ”»ç©å®¶å§“å" value="ç©å®¶1" />
            </div>
            <div class="input-group player-input-group">
                <label for="player2" style="color: #553c9a;">å¾Œæ”»ç©å®¶</label>
                <input type="text" id="player2" placeholder="è¼¸å…¥å¾Œæ”»ç©å®¶å§“å" value="ç©å®¶2" />
            </div>
        </div>
        <button id="startBtn" class="btn-primary" type="button">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            é–‹å§‹æŒ‘æˆ°
        </button>
    </div>
    <div id="game" style="display:none; position: relative; min-height: 500px;">
        <div id="info" class="panel"></div>
        <div id="error" class="alert error" style="display:none;"></div>
        <div class="number-grid" id="numberGrid"></div>
        <div style="display: flex; justify-content: center; margin-top: 20px;">
            <button id="resetBtn" class="restart-btn" type="button">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-ccw">
                    <path d="M3 12a9 9 0 1 0 9-9v1.72a.5.5 0 0 1-.84.385L9.61 2.373a1 1 0 0 0-1.226-.145L4.852 4.6a1 1 0 0 0-.217 1.258l2.257 3.518A.5.5 0 0 1 7.28 10h1.72a9 9 0 0 0-9 9"/>
                </svg>
                <span>é‡æ–°é–‹å§‹</span>
            </button>
        </div>
    </div>
    <script>
        (function(){
            let gameState = 'setup';
            let currentPlayer = 1;
            let selectedNumbers = new Map();
            let gameHistory = [];
            let playerNames = {player1: 'ç©å®¶ä¸€', player2: 'ç©å®¶äºŒ'};
            let winner = null;
            let lastSelectedNumber = null;
            let errorTimeout = null;
            const setupDiv = document.getElementById('setup');
            const gameDiv = document.getElementById('game');
            const startBtn = document.getElementById('startBtn');
            const resetBtn = document.getElementById('resetBtn');
            const player1Input = document.getElementById('player1');
            const player2Input = document.getElementById('player2');
            const numberGrid = document.getElementById('numberGrid');
            const infoDiv = document.getElementById('info');
            const errorDiv = document.getElementById('error');
            function getFactors(num) {
                const factors = [];
                for(let i=1; i<=num; i++) {
                    if(num % i === 0) factors.push(i);
                }
                return factors;
            }
            function getMultiples(num) {
                const multiples = [];
                for(let i=num; i<=100; i+=num) {
                    multiples.push(i);
                }
                return multiples;
            }
            function isValidMove(selectedNum, targetNum) {
                if(selectedNum === targetNum) return false;
                if(selectedNum % targetNum === 0) return true;
                if(targetNum % selectedNum === 0) return true;
                return false;
            }
            function calculatePossibleMoves(selectedNum, usedNumbers) {
                if(!selectedNum) return new Set();
                const factors = getFactors(selectedNum);
                const multiples = getMultiples(selectedNum);
                const allPossible = [...factors, ...multiples];
                const filtered = allPossible.filter(n => !usedNumbers.has(n));
                return new Set(filtered);
            }
            function showError(msg) {
                clearTimeout(errorTimeout);
                errorDiv.textContent = msg;
                errorDiv.style.display = 'flex';
                errorTimeout = setTimeout(() => {
                    errorDiv.style.display = 'none';
                    errorDiv.textContent = '';
                }, 3000);
            }
            function renderNumberGrid() {
                numberGrid.innerHTML = '';
                for(let i = 1; i <= 100; i++) {
                    const btn = document.createElement('button');
                    btn.textContent = i;
                    btn.addEventListener('click', () => selectNumber(i));
                    const player = selectedNumbers.get(i);
                    if (player) {
                        btn.classList.add('selected', `player${player}`);
                        btn.disabled = true;
                    }
                    if(i === lastSelectedNumber) {
                        btn.classList.add('last-selected');
                    }
                    numberGrid.appendChild(btn);
                }
            }
            function renderInfo() {
                if(gameState === 'finished') {
                    infoDiv.innerHTML = `<span class="turn-info">ğŸ‰ æ­å–œ ${playerNames['player'+winner]} ç²å‹ï¼ ğŸ‰</span><span class="last-number-info" style="display:none;"></span>`;
                    const winInfo = infoDiv.querySelector('.turn-info');
                    if (winInfo) {
                        winInfo.classList.add('win-animation');
                    }
                } else if(gameState === 'playing') {
                    const msg = gameHistory.length === 0
                        ? `è¼ªåˆ° ${playerNames['player'+currentPlayer]} (è«‹é¸æ“‡ 1-20 çš„æ•¸å­—)`
                        : `è¼ªåˆ° ${playerNames['player'+currentPlayer]} (é¸æ“‡å› æ•¸æˆ–å€æ•¸)`;
                    infoDiv.innerHTML = `<span class="turn-info">${msg}</span>`;
                    if(lastSelectedNumber !== null) {
                        infoDiv.innerHTML += `<span class="last-number-info">ç¾åœ¨é¸æ“‡çš„æ•¸å­—æ˜¯ï¼š${lastSelectedNumber}</span>`;
                    } else {
                        infoDiv.innerHTML += `<span class="last-number-info"></span>`;
                    }
                } else {
                    infoDiv.innerHTML = '';
                }
            }
            function selectNumber(number) {
                if(gameState !== 'playing') return;
                if(selectedNumbers.has(number)) {
                    showError('é€™å€‹æ•¸å­—å·²ç¶“è¢«é¸éäº†ï¼');
                    return;
                }
                if(gameHistory.length === 0) {
                    if(number < 1 || number > 20) {
                        showError('å…ˆæ”»ç©å®¶åªèƒ½é¸æ“‡ 1-20 çš„æ•¸å­—ï¼');
                        return;
                    }
                } else {
                    if(!isValidMove(lastSelectedNumber, number)) {
                        showError(`${number} ä¸æ˜¯ ${lastSelectedNumber} çš„å› æ•¸æˆ–å€æ•¸ï¼`);
                        return;
                    }
                }
                selectedNumbers.set(number, currentPlayer);
                gameHistory.push({
                    player: currentPlayer,
                    number,
                    playerName: playerNames['player'+currentPlayer]
                });
                lastSelectedNumber = number;
                errorDiv.style.display = 'none';
                errorDiv.textContent = '';
                const nextMoves = calculatePossibleMoves(number, selectedNumbers);
                if(nextMoves.size === 0) {
                    winner = currentPlayer;
                    gameState = 'finished';
                } else {
                    currentPlayer = currentPlayer === 1 ? 2 : 1;
                }
                updateUI();
            }
            function startGame() {
                const p1 = player1Input.value.trim() || 'ç©å®¶ä¸€';
                const p2 = player2Input.value.trim() || 'ç©å®¶äºŒ';
                playerNames = {player1: p1, player2: p2};
                gameState = 'playing';
                currentPlayer = 1;
                selectedNumbers = new Map();
                gameHistory = [];
                winner = null;
                lastSelectedNumber = null;
                errorDiv.style.display = 'none';
                errorDiv.textContent = '';
                setupDiv.style.display = 'none';
                gameDiv.style.display = 'block';
                updateUI();
            }
            function resetGame() {
                gameState = 'setup';
                currentPlayer = 1;
                selectedNumbers = new Map();
                gameHistory = [];
                winner = null;
                lastSelectedNumber = null;
                errorDiv.style.display = 'none';
                errorDiv.textContent = '';
                setupDiv.style.display = 'flex';
                gameDiv.style.display = 'none';
                updateUI();
            }
            function updateUI() {
                renderNumberGrid();
                renderInfo();
            }
            startBtn.addEventListener('click', startGame);
            resetBtn.addEventListener('click', resetGame);
        })();
    </script>
</body>
</html>